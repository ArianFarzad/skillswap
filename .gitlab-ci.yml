image: node:18

stages:
  - test
  - analyze

test_backend:
  stage: test
  script:
    - cd backend
    - npm ci
    - npm test

test_frontend:
  stage: test
  before_script:
    - mkdir -p frontend/.nyc_output
  script:
    - cd frontend
    - npm ci
    - npm run test:coverage
  artifacts:
    paths:
      - frontend/coverage/src/coverage.svg
    expire_in: 1 week
  coverage: '/All files\s*\|\s*([\d]+(\.\d+)?)%/'

analyze_backend:
  stage: analyze
  script:
    - cd backend
    - npm ci
    - npm run lint
    - npm run format

analyze_frontend:
  stage: analyze
  script:
    - cd frontend
    - npm ci
    - npm run lint
    - npm run format


